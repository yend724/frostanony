# Frostanony 要件定義書

## プロジェクト概要
**Frostanony**は、画像内の顔を自動検出し、プライバシー保護のためのエフェクト（ぼかし・モザイク）を適用するWebアプリケーションです。ブラウザ内で完結し、画像データは外部サーバーに送信されません。

## ターゲットユーザー
- 一般ユーザー（SNS投稿前の顔の匿名化）
- ビジネスユーザー（報告書・プレゼンテーション資料の作成）

## 機能要件

### 1. 画像アップロード機能
#### 1.1 アップロード方法
- ドラッグ&ドロップによるアップロード
- クリックによるファイル選択
- プログレッシブエンハンスメント（両方の方法をサポート）

#### 1.2 対応ファイル
- **対応形式**: JPEG (.jpg, .jpeg), PNG (.png), WebP (.webp)
- **ファイルサイズ制限**: 最大10MB
- **エラーハンドリング**: 非対応形式やサイズ超過時にエラーメッセージを表示

### 2. 顔検出・エフェクト適用機能
#### 2.1 顔検出
- TensorFlow.js（BlazeFaceモデル推奨）による自動顔検出
- 複数の顔の同時検出に対応
- アップロード後、自動的に顔検出を実行
- 検出した顔の位置を視覚的に表示（枠線など）

#### 2.2 エフェクト設定
- **エフェクトの種類**:
  - ぼかし効果
  - ピクセルモザイク効果
- **デフォルト設定**: 中程度の強度のぼかし効果
- **強度調整**: スライダーによる5段階調整（弱・やや弱・中・やや強・強）
- **選択方法**: ラジオボタンによるエフェクト選択

#### 2.3 適用プロセス
- 「適用」ボタンによる明示的な処理実行
- エフェクトや強度を変更後、再度適用可能
- 処理中はローディング表示

### 3. プレビュー機能
#### 3.1 表示方法
- アップロード時に元画像を表示
- 適用ボタン押下後、処理済み画像に切り替え
- 比較表示は不要（処理済み画像のみ表示）

#### 3.2 画像表示の制御
- 大きい画像の場合：
  - コンテナに合わせて自動リサイズ
  - スクロール可能
  - ズーム機能（ピンチズーム、ボタンによるズーム）
- アスペクト比は常に維持

### 4. ダウンロード機能
- ワンクリックでダウンロード開始
- **ファイル形式**: 元の画像形式を維持
- **ファイル名**: 元のファイル名に「_anonymized」を付与
  - 例: photo.jpg → photo_anonymized.jpg

### 5. エラー処理・フィードバック
#### 5.1 顔が検出されなかった場合
- プレビューエリア内に「顔が検出されませんでした」とメッセージ表示
- 元画像はそのまま表示（ダウンロード可能）

#### 5.2 その他のフィードバック
- 処理完了時の通知
- エラー発生時の分かりやすいメッセージ

## 非機能要件

### 1. パフォーマンス
- 一般的な画像（2000x2000px以下）で5秒以内の処理
- オフライン環境での動作（初回ロード後）
- WebGLによる高速処理

### 2. セキュリティ・プライバシー
- 画像データの外部送信なし
- ブラウザメモリ内での処理完結
- 処理後の自動メモリクリア
- HTTPS環境での動作

### 3. ユーザビリティ
- 直感的な3ステップ操作
  1. 画像アップロード
  2. エフェクト選択・適用
  3. ダウンロード
- レスポンシブデザイン（モバイル最適化）
- アクセシビリティ対応

### 4. デザイン・UI
- **テーマ**: 親しみやすくカジュアル
- **カラー**: オレンジ系の暖色をアクセントカラーとして使用
- **レイアウト**:
  - デスクトップ: 左右分割（設定エリア｜プレビューエリア）
  - モバイル: 縦並び配置

## 技術仕様

### フロントエンド
- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript 5.x
- **スタイリング**: Tailwind CSS + Tailwind Variants
- **状態管理**: React hooks（useState, useReducer）

### 画像処理・機械学習
- **顔検出**: TensorFlow.js with BlazeFace
- **画像処理**: Canvas API
- **パフォーマンス**: Web Workers（重い処理の非同期実行）

### 開発環境
- **パッケージマネージャー**: npm or pnpm
- **コード品質**:
  - ESLint
  - Prettier
  - TypeScript strict mode
- **ビルドツール**: Next.js built-in

## 実装における設計方針

### 1. 拡張性を考慮した設計
- エフェクトの種類は設定オブジェクトで管理（ハードコード回避）
- 将来的な複数画像処理に対応できる内部設計
- 検出対象（顔以外）の追加を想定したインターフェース設計

### 2. アーキテクチャ設計
- **Package by Feature**: 機能ごとにコードを分離
- **Feature-Sliced Design（FSD）**: レイヤー化アーキテクチャを採用
  - `app/`: アプリケーション初期化とルーティング
  - `views/`: ページレベルのコンポーネント
  - `features/`: ビジネス機能の実装
  - `entities/`: ビジネスエンティティ
  - `shared/`: 共通のユーティリティとコンポーネント
- カスタムフックによるロジックの分離
- 再利用可能なUIコンポーネントの作成

### 3. エラーハンドリング
- try-catchによる適切なエラー捕捉
- ユーザーフレンドリーなエラーメッセージ
- フォールバック処理の実装

## 画面構成

### メイン画面
1. **ヘッダー**
   - アプリ名「Frostanony」
   - 簡潔な説明文

2. **コンテンツエリア**
   - **左側（デスクトップ）/上部（モバイル）**:
     - アップロードエリア
     - エフェクト設定パネル
     - 適用ボタン
   - **右側（デスクトップ）/下部（モバイル）**:
     - プレビューエリア
     - ダウンロードボタン
     - ステータスメッセージ

3. **フッター**
   - コピーライト
   - プライバシーポリシーリンク（必要に応じて）

## 今後の拡張可能性
- 複数画像の一括処理
- 動画対応
- 顔以外のオブジェクト検出（ナンバープレート等）
- より多様なエフェクト（部分的なぼかし、色変更等）